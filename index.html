<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Météo Amiens - Temps réel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            color: #00ff00;
            font-family: 'Courier New', 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            line-height: 1.4;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            border: double 3px #00ff00;
            padding: 15px;
        }

        .title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .subtitle {
            font-size: 12px;
            color: #ffff00;
        }

        .timestamp {
            color: #888;
            margin-top: 10px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            margin-bottom: 30px;
        }

        .panel {
            border: solid 1px #00ff00;
            padding: 20px;
            background: rgba(0, 255, 0, 0.05);
            display: flex;
            flex-direction: column;
        }

        .panel-title {
            color: #ffff00;
            font-weight: bold;
            margin-bottom: 10px;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }

        .data-line {
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .label {
            color: #ccc;
        }

        .value {
            color: #00ff00;
            font-weight: bold;
        }

        .value.warning {
            color: #ffff00;
        }

        .value.danger {
            color: #ff0000;
        }

        .weather-visual {
            margin: 30px 0;
            border: double 3px #00ff00;
            padding: 20px;
            text-align: center;
        }

        .visual-title {
            color: #ffff00;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }

        .ascii-weather {
            font-size: 10px;
            line-height: 1;
            color: #00ff00;
            margin: 20px auto;
            white-space: pre;
            font-family: monospace;
        }

        .weather-description {
            color: #ffff00;
            font-size: 18px;
            font-weight: bold;
            margin-top: 20px;
        }

        .activity-section {
            margin: 30px 0;
            border: solid 1px #888;
            padding: 20px;
        }

        .activity-title {
            color: #ffff00;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .activity-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .activity-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border: 1px solid #333;
            background: rgba(0, 255, 0, 0.02);
        }

        .status-ok { color: #00ff00; }
        .status-caution { color: #ffff00; }
        .status-bad { color: #ff0000; }

        .footer {
            margin-top: 40px;
            text-align: center;
            color: #666;
            border-top: 1px solid #333;
            padding-top: 20px;
        }

        .ascii-art {
            color: #888;
            font-size: 10px;
            text-align: center;
            margin: 20px 0;
        }

        .loading {
            color: #ffff00;
            text-align: center;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            body {
                font-size: 12px;
                padding: 10px;
            }

            .main-grid {
                grid-template-columns: 1fr;
            }

            .activity-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">═══ METEO AMIENS ═══</div>
            <div class="subtitle">Données en temps réel</div>
            <div class="timestamp" id="timestamp">DERNIERE MAJ: --</div>
        </div>

        <div class="loading" id="loading">
            CHARGEMENT DES DONNEES SATELLITAIRES...
            [████████████████████████████████████████] 100%
        </div>

        <div id="weather-content" style="display: none;">
            <div class="weather-visual">
                <div class="visual-title">[ CONDITIONS ACTUELLES ]</div>
                <div class="ascii-weather" id="ascii-weather">
                    <!-- ASCII art sera inséré ici par JavaScript -->
                </div>
                <div class="weather-description" id="weather-description">
                    <!-- Description sera insérée ici -->
                </div>
            </div>

            <div class="main-grid">
                <div class="panel">
                    <div class="panel-title">[ TEMPERATURE ]</div>
                    <div class="data-line">
                        <span class="label">ACTUELLE:</span>
                        <span class="value" id="temp-current">--°C</span>
                    </div>
                    <div class="data-line">
                        <span class="label">RESSENTIE:</span>
                        <span class="value" id="temp-feels">--°C</span>
                    </div>
                    <div class="data-line">
                        <span class="label">MIN/MAX:</span>
                        <span class="value" id="temp-minmax">--°C / --°C</span>
                    </div>
                    <div class="data-line">
                        <span class="label">TENDANCE 3H:</span>
                        <span class="value" id="temp-trend">STABLE</span>
                    </div>
                    <div class="data-line">
                        <span class="label">NORMAL SAISON:</span>
                        <span class="value" id="temp-normal">OUI</span>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-title">[ PRECIPITATIONS ]</div>
                    <div class="data-line">
                        <span class="label">PROBABILITE:</span>
                        <span class="value" id="rain-prob">--%</span>
                    </div>
                    <div class="data-line">
                        <span class="label">QUANTITE SI PLUIE:</span>
                        <span class="value" id="rain-amount">-- mm</span>
                    </div>
                    <div class="data-line">
                        <span class="label">DERNIERE PLUIE:</span>
                        <span class="value" id="last-rain">-- JOURS</span>
                    </div>
                    <div class="data-line">
                        <span class="label">CUMUL SEMAINE:</span>
                        <span class="value" id="week-rain">-- mm</span>
                    </div>
                    <div class="data-line">
                        <span class="label">PARAPLUIE REQUIS:</span>
                        <span class="value" id="umbrella-needed">NON</span>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-title">[ VENT ]</div>
                    <div class="data-line">
                        <span class="label">VITESSE MOYENNE:</span>
                        <span class="value" id="wind-speed">-- km/h</span>
                    </div>
                    <div class="data-line">
                        <span class="label">RAFALES MAX:</span>
                        <span class="value" id="wind-gusts">-- km/h</span>
                    </div>
                    <div class="data-line">
                        <span class="label">DIRECTION:</span>
                        <span class="value" id="wind-direction">--</span>
                    </div>
                    <div class="data-line">
                        <span class="label">CLASSIFICATION:</span>
                        <span class="value" id="wind-class">BRISE LEGERE</span>
                    </div>
                    <div class="data-line">
                        <span class="label">DANGEREUX:</span>
                        <span class="value" id="wind-danger">NON</span>
                    </div>
                </div>
            </div>

            <div class="activity-section">
                <div class="activity-title">[ ACTIVITES CONSEILLEES ]</div>
                <div class="activity-grid">
                    <div class="activity-item">
                        <span>VELO/FOOTING:</span>
                        <span class="status-ok" id="activity-sport">PARFAIT</span>
                    </div>
                    <div class="activity-item">
                        <span>PIQUE-NIQUE:</span>
                        <span class="status-caution" id="activity-picnic">PREVOIR PULL</span>
                    </div>
                    <div class="activity-item">
                        <span>JARDINAGE:</span>
                        <span class="status-ok" id="activity-garden">IDEAL</span>
                    </div>
                    <div class="activity-item">
                        <span>ETENDRE LINGE:</span>
                        <span class="status-ok" id="activity-laundry">SECHERA EN 3H</span>
                    </div>
                    <div class="activity-item">
                        <span>BARBECUE:</span>
                        <span class="status-ok" id="activity-bbq">GO</span>
                    </div>
                    <div class="activity-item">
                        <span>LAVER VOITURE:</span>
                        <span class="status-caution" id="activity-car">ATTENDRE 2J</span>
                    </div>
                </div>
            </div>

            <div class="ascii-art">
                ┌─────────────────────────────────────────────────────────────┐<br>
                │               Météo locale sans exagération                │<br>
                │               Données Open-Meteo.com fiables               │<br>
                └─────────────────────────────────────────────────────────────┘
            </div>
        </div>

        <div class="footer">
            <div>Station Amiens - Coordonnées: 49.9°N, 2.3°E</div>
            <div>Source: Open-Meteo.com | Mise à jour: 10 minutes</div>
        </div>
    </div>

    <script>
        // Coordonnées d'Amiens
        const AMIENS_LAT = 49.9;
        const AMIENS_LON = 2.3;

        // Dessins ASCII pour chaque condition météo
        const weatherAsciiArt = {
            sunny: `
           \\   /
            .-.
         ― (   ) ―
            \`-'
           /   \\`,

            partlyCloudy: `
           \\  /
         _ /"".-.
           \\_(   ).
           /(_____)`,

            cloudy: `
              .--.
           .-(    ).
          (___.__)__)`,

            rainy: `
              .--.
           .-(    ).
          (___.__)__)
           ‚'‚'‚'‚'
           ‚'‚'‚'‚'`,

            heavyRain: `
              .--.
           .-(    ).
          (___.__)__)
          ///////////
         ///////////`,

            stormy: `
              .--.
           .-(    ).
          (___.__)__)
           ⚡‚'⚡‚'⚡
           ‚'⚡‚'⚡‚'`,

            snowy: `
              .--.
           .-(    ).
          (___.__)__)
           * * * * *
          * * * * *`,

            foggy: `
          _ - _ - _ -
        _ - _ - _ -
          _ - _ - _ -
        _ - _ - _ -
          _ - _ - _ -`,

            windy: `
        ~~~~     ~~~~
      ~~~~   ~~~~
        ~~~~     ~~~~
      ~~~~   ~~~~
        ~~~~     ~~~~`,

            night: `
              .-.
            (  ₀ )
              \`-'
           * ˚  . *
          .  *  ˚  .`
        };

        // Classification des vents selon échelle de Beaufort
        function getWindClassification(speed) {
            if (speed < 6) return "CALME";
            if (speed < 12) return "BRISE LEGERE";
            if (speed < 20) return "BRISE MODEREE";
            if (speed < 29) return "BONNE BRISE";
            if (speed < 39) return "VENT FRAIS";
            if (speed < 50) return "VENT FORT";
            return "TEMPETE";
        }

        // Direction du vent en texte
        function getWindDirection(degrees) {
            const directions = ["N", "NNE", "NE", "ENE", "E", "ESE", "SE", "SSE", "S", "SSO", "SO", "OSO", "O", "ONO", "NO", "NNO"];
            const index = Math.round(degrees / 22.5) % 16;
            return directions[index];
        }

        // Déterminer l'ASCII art et la description selon le code météo
        function getWeatherVisualization(weatherCode, isDay, precipitation, cloudCover, windSpeed) {
            let art = "";
            let description = "";

            // Codes météo WMO
            // 0: Clear sky
            // 1, 2, 3: Mainly clear, partly cloudy, and overcast
            // 45, 48: Fog and depositing rime fog
            // 51, 53, 55: Drizzle: Light, moderate, and dense intensity
            // 61, 63, 65: Rain: Slight, moderate and heavy intensity
            // 71, 73, 75: Snow fall: Slight, moderate, and heavy intensity
            // 80, 81, 82: Rain showers: Slight, moderate, and violent
            // 95: Thunderstorm: Slight or moderate
            // 96, 99: Thunderstorm with slight and heavy hail

            if (!isDay) {
                art = weatherAsciiArt.night;
                description = "NUIT ";
            }

            switch(weatherCode) {
                case 0:
                    if (isDay) {
                        art = weatherAsciiArt.sunny;
                        description = "ENSOLEILLE";
                    } else {
                        description += "CLAIRE";
                    }
                    break;
                case 1:
                case 2:
                    if (isDay) {
                        art = weatherAsciiArt.partlyCloudy;
                        description = "PARTIELLEMENT NUAGEUX";
                    } else {
                        description += "PARTIELLEMENT NUAGEUSE";
                    }
                    break;
                case 3:
                    art = weatherAsciiArt.cloudy;
                    description = isDay ? "NUAGEUX" : description + "NUAGEUSE";
                    break;
                case 45:
                case 48:
                    art = weatherAsciiArt.foggy;
                    description = "BROUILLARD";
                    break;
                case 51:
                case 53:
                case 55:
                    art = weatherAsciiArt.rainy;
                    description = "BRUINE";
                    break;
                case 61:
                case 63:
                case 65:
                    art = weatherAsciiArt.rainy;
                    description = weatherCode === 65 ? "FORTE PLUIE" : "PLUIE";
                    break;
                case 71:
                case 73:
                case 75:
                    art = weatherAsciiArt.snowy;
                    description = "NEIGE";
                    break;
                case 80:
                case 81:
                case 82:
                    art = weatherAsciiArt.heavyRain;
                    description = "AVERSES";
                    break;
                case 95:
                case 96:
                case 99:
                    art = weatherAsciiArt.stormy;
                    description = "ORAGE";
                    break;
                default:
                    // Fallback basé sur d'autres paramètres
                    if (precipitation > 0.5) {
                        art = weatherAsciiArt.rainy;
                        description = "PLUVIEUX";
                    } else if (cloudCover > 70) {
                        art = weatherAsciiArt.cloudy;
                        description = "TRES NUAGEUX";
                    } else if (cloudCover > 30) {
                        art = weatherAsciiArt.partlyCloudy;
                        description = "PARTIELLEMENT NUAGEUX";
                    } else if (windSpeed > 30) {
                        art = weatherAsciiArt.windy;
                        description = "VENTEUX";
                    } else {
                        art = isDay ? weatherAsciiArt.sunny : weatherAsciiArt.night;
                        description = isDay ? "CLAIR" : "NUIT CLAIRE";
                    }
            }

            return { art, description };
        }

        // Calculer les recommandations d'activités
        function calculateActivities(data) {
            const current = data.current;
            const temp = current.temperature_2m;
            const rain = current.precipitation;
            const wind = current.wind_speed_10m;

            return {
                sport: rain < 0.1 && wind < 25 ? "PARFAIT" : rain < 1 ? "ACCEPTABLE" : "REPORTER",
                picnic: temp > 15 && rain < 0.1 ? "IDEAL" : temp > 10 ? "PREVOIR PULL" : "TROP FROID",
                garden: rain < 0.1 && wind < 20 ? "IDEAL" : "ATTENDRE",
                laundry: rain < 0.1 && wind > 5 ? "SECHERA EN 3H" : rain < 0.1 ? "SECHERA LENTEMENT" : "REPORTER",
                bbq: rain < 0.1 && wind < 15 ? "GO" : "REPORTER",
                car: rain < 0.1 ? "GO" : "ATTENDRE 2J"
            };
        }

        async function loadWeatherData() {
            try {
                const response = await fetch(
                    `https://api.open-meteo.com/v1/forecast?latitude=${AMIENS_LAT}&longitude=${AMIENS_LON}&current=temperature_2m,relative_humidity_2m,apparent_temperature,is_day,precipitation,weather_code,cloud_cover,pressure_msl,wind_speed_10m,wind_direction_10m,wind_gusts_10m&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,precipitation_probability_max&timezone=Europe%2FParis&forecast_days=1`
                );

                if (!response.ok) {
                    throw new Error('Erreur chargement données');
                }

                const data = await response.json();
                displayWeatherData(data);

                document.getElementById('loading').style.display = 'none';
                document.getElementById('weather-content').style.display = 'block';

                document.getElementById('timestamp').textContent =
                    `DERNIERE MAJ: ${new Date().toLocaleString('fr-FR')}`;

            } catch (error) {
                console.error('Erreur:', error);
                document.getElementById('loading').innerHTML =
                    '<span style="color: #ff0000;">ERREUR CONNEXION SATELLITE - RETRY...</span>';
            }
        }

        function displayWeatherData(data) {
            const current = data.current;
            const daily = data.daily;

            // Température
            document.getElementById('temp-current').textContent = `${Math.round(current.temperature_2m)}°C`;
            document.getElementById('temp-feels').textContent = `${Math.round(current.apparent_temperature)}°C`;
            document.getElementById('temp-minmax').textContent = `${Math.round(daily.temperature_2m_min[0])}°C / ${Math.round(daily.temperature_2m_max[0])}°C`;

            // Précipitations
            const rainProb = daily.precipitation_probability_max[0] || 0;
            document.getElementById('rain-prob').textContent = `${rainProb}%`;
            document.getElementById('rain-amount').textContent = current.precipitation > 0 ? `${current.precipitation.toFixed(1)} mm` : "< 0.1 mm";
            document.getElementById('umbrella-needed').textContent = rainProb > 70 ? "OUI" : "NON";

            // Vent
            document.getElementById('wind-speed').textContent = `${Math.round(current.wind_speed_10m)} km/h`;
            document.getElementById('wind-gusts').textContent = `${Math.round(current.wind_gusts_10m)} km/h`;
            document.getElementById('wind-direction').textContent = getWindDirection(current.wind_direction_10m);
            document.getElementById('wind-class').textContent = getWindClassification(current.wind_speed_10m);
            document.getElementById('wind-danger').textContent = current.wind_speed_10m > 50 ? "OUI" : "NON";

            // ASCII Art et description météo
            const visualization = getWeatherVisualization(
                current.weather_code,
                current.is_day === 1,
                current.precipitation,
                current.cloud_cover,
                current.wind_speed_10m
            );
            document.getElementById('ascii-weather').textContent = visualization.art;
            document.getElementById('weather-description').textContent = visualization.description;

            // Activités
            const activities = calculateActivities(data);
            document.getElementById('activity-sport').textContent = activities.sport;
            document.getElementById('activity-picnic').textContent = activities.picnic;
            document.getElementById('activity-garden').textContent = activities.garden;
            document.getElementById('activity-laundry').textContent = activities.laundry;
            document.getElementById('activity-bbq').textContent = activities.bbq;
            document.getElementById('activity-car').textContent = activities.car;

            // Colorer selon les résultats
            ['sport', 'picnic', 'garden', 'laundry', 'bbq', 'car'].forEach(activity => {
                const element = document.getElementById(`activity-${activity}`);
                const text = element.textContent;
                if (text.includes('PARFAIT') || text.includes('IDEAL') || text.includes('GO')) {
                    element.className = 'status-ok';
                } else if (text.includes('PREVOIR') || text.includes('ATTENDRE') || text.includes('LENTEMENT')) {
                    element.className = 'status-caution';
                } else {
                    element.className = 'status-bad';
                }
            });
        }

        // Charger les données au démarrage
        loadWeatherData();

        // Actualiser toutes les 10 minutes
        setInterval(loadWeatherData, 600000);
    </script>
</body>
</html>